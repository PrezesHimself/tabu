<!DOCTYPE html>
<html class="no-js" lang="">
  <head>
    <meta charset="utf-8" />
    <title></title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta property="og:title" content="" />
    <meta property="og:type" content="" />
    <meta property="og:url" content="" />
    <meta property="og:image" content="" />
  </head>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css"
    integrity="sha512-8bHTC73gkZ7rZ7vpqUQThUDhqcNFyYi2xgDgPDHc+GXVGHXq+xPjynxIopALmOPqzo9JZj0k6OqqewdGO3EsrQ=="
    crossorigin="anonymous"
  />
  <style>
    body {
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .splash,
    .game {
      position: absolute;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      display: flex;
      flex-direction: column;
      padding: 20px;
    }
    .splash > .card,
    .game > .card {
      width: 100vw;
      height: 100vh;
    }
  </style>
  <body>
    <div class="splash">
      <div class="ui card">
        <div class="content">
          <h2 class="team"></h2>
        </div>
        <div class="content">
          <h4 class="readiness"></h4>
        </div>
        <div class="extra content">
          <div class="ui large transparent left icon input">
            <button class="ui button ready">ready</button>
          </div>
        </div>
      </div>
    </div>
    <div class="game">
      <div class="ui card">
        <div class="content">
          <h2 class="team"></h2>

          <div class="your-turn"></div>
          <div class="score"></div>
          <div class="timer"></div>
        </div>
        <div class="content">
          <div class="tabu"></div>
        </div>
        <div class="extra content">
          <div class="ui large transparent left icon input">
            <div class="buttons">
              <button class="ui button skip">skip</button>
              <button class="ui button ok">ok</button>
              <button class="ui button wrong">wrong</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/jquery/dist/jquery.js"></script>
    <script>
      const socket = io.connect('http://192.168.0.107:4200');
      let count;
      let interval;
      socket.on('connect', function (data) {
        socket.emit('join', socket.id);
      });
      socket.on('gameState', function (data) {
        const {
          gameIsOn,
          readiness,
          tabu,
          score,
          yourTeam,
          yourTurn,
          teamsTurn,
          roundLength,
        } = data;
        $('.team').html('You are in team: ' + yourTeam);
        console.log('its on?', data);
        if (!gameIsOn) {
          $('.splash').show();
          $('.game').hide();
          $('.readiness').html(readiness ? readiness + ' ready' : '');
          $('.timer').html('');
        } else {
          console.log('its on');
          $('.splash').hide();
          $('.game').show();
          $('.tabu').html(tabu ? tabu : '');
          $('.score').text(`blue ${score.blue} : ${score.red} red`);

          $('.your-turn').text(
            yourTurn ? 'It is your turn' : 'not your turn mate'
          );
          if (yourTurn) {
            $('.skip').show();
            $('.ok').show();
            count = roundLength;
            if (!interval) {
              interval = setInterval(() => {
                if (count <= 0) clearInterval(interval);
                console.log(count);
                $('.timer').html(count--);
              }, 1000);
            }
          } else {
            $('.timer').html('');
            clearInterval(interval);
            $('.skip').hide();
            $('.ok').hide();
          }

          if (teamsTurn === yourTeam) {
            $('.wrong').hide();
          } else {
            $('.wrong').show();
          }
        }
      });

      $('.skip').click((event) => {
        socket.emit('skip', socket.id);
      });
      $('.ready').click((event) => {
        socket.emit('ready', socket.id);
      });
      $('.ok').click((event) => {
        socket.emit('ok', socket.id);
      });
      $('.wrong').click((event) => {
        socket.emit('wrong', socket.id);
      });
    </script>
  </body>
</html>
